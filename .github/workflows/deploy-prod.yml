name: Deploy Streamlit PROD

on:
  push:
    branches:
      - main

env:
  APP_VERSION: v1.0.${{ github.run_number }}
  
  jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v4

      # Navega para o diret√≥rio clonado
      - name: Set working directory
        run: cd _work/Amaazonet_Data_clear/Amaazonet_Data_clear
        shell: powershell

      # Docker down
      - name: Docker down (remove volumes)
        run: docker compose down --volumes --remove-orphans
        shell: powershell

      # Build da imagem
      - name: Build Docker image (no cache)
        run: docker compose build --no-cache
        shell: powershell

      # Deploy container
      - name: Deploy Docker container
        run: docker compose up -d
        shell: powershell

      # Verifica containers
      - name: Docker ps
        run: docker ps
        shell: powershell
